{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to Kusk Developers deploying their REST APIs in Kubernetes shouldn't have to worry about managing resources that do not directly relate to their applications or services. Kusk ( coachman in Swedish ) treats your OpenAPI/Swagger definition as a source of truth for generating supplementary Kubernetes resources for your REST APIs in regard to mappings, security, traffic-control, monitoring, etc. The Kusk wizard can inspect your cluster for the tools it supports and generate corresponding resources automatically. the Kusk OpenAPI extension allows you to specify QoS and k8s related metadata which will be used to configure your cluster accordingly. Kusk plays nicely with both manual and automated/GitOps/CD workflows (see examples below). The underlying architecture makes it straight-forward to add new generators (see Development ) kusk-gen Wizard kusk-gen comes with a kusk-gen wizard interactive CLI to help you get started!","title":"Welcome"},{"location":"#welcome-to-kusk","text":"Developers deploying their REST APIs in Kubernetes shouldn't have to worry about managing resources that do not directly relate to their applications or services. Kusk ( coachman in Swedish ) treats your OpenAPI/Swagger definition as a source of truth for generating supplementary Kubernetes resources for your REST APIs in regard to mappings, security, traffic-control, monitoring, etc. The Kusk wizard can inspect your cluster for the tools it supports and generate corresponding resources automatically. the Kusk OpenAPI extension allows you to specify QoS and k8s related metadata which will be used to configure your cluster accordingly. Kusk plays nicely with both manual and automated/GitOps/CD workflows (see examples below). The underlying architecture makes it straight-forward to add new generators (see Development )","title":"Welcome to Kusk"},{"location":"#kusk-gen-wizard","text":"kusk-gen comes with a kusk-gen wizard interactive CLI to help you get started!","title":"kusk-gen Wizard"},{"location":"ambassador/","text":"Ambassador Note : Ambassador uses CustomResourceDefinition s with apiVersion = apiextensions.k8s.io/v1beta1 which was removed in Kubernetes version 1.22+. Please ensure your Kubernetes version is compatible with the version of Ambassador you're using kusk-gen ambassador --help Generates Ambassador Mappings for your service Usage: kusk-gen ambassador [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --path.base string a base path for Service endpoints ( default \"/\" ) --path.split force Kusk to generate a separate Mapping for each operation --path.trim_prefix string a prefix to trim from the URL before forwarding to the upstream Service --timeouts.idle_timeout uint32 idle connection timeout ( seconds ) --timeouts.request_timeout uint32 total request timeout ( seconds ) -h, --help help for ambassador The Ambassador generator generates Mapping resources for mapping resource to services. All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification. Full Options Reference Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Path Trim Prefix --path.trim_prefix path.trim_prefix Trim the specified prefix from URl before passing request onto service \u274c Path split --path.split path.split Boolean; whether or not to force generator to generate a mapping for each path \u274c Host --host host The value to set the host field to in the Mapping resource \u2705 Rate limit (RPS) --rate_limits.rps rate_limits.rps Request per second rate limit \u2705 Rate limit (burst) --rate_limits.burst rate_limits.burst Rate limit burst \u2705 Rate limit group N/A rate_limits.group Rate limit endpoint group Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705 Idle Timeout --timeouts.idle_timeout timeouts.idle_timeout Idle connection timeout (seconds) \u2705 CORS Origins N/A cors.origins Array of origins \u2705 CORS Methods N/A cors.methods Array of methods \u2705 CORS Headers N/A cors.headers Array of headers \u2705 CORS ExposeHeaders N/A cors.expose_headers Array of headers to expose \u2705 CORS Credentials N/A cors.credentials Boolean: enable credentials (default value: false) \u2705 CORS Max Age N/A cors.max_age Integer:how long the response to the preflight request can be cached for without sending another preflight request \u2705 ## Basic Usage CLI Flags kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 paths : / : get : {} ... Sample Output --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp namespace : my-namespace spec : prefix : \"/\" service : booksapp.my-service-namespace:7000 rewrite : \"\" Split Path By setting split path to true, kusk-gen will generate a mapping per route specified in the provided OpenAPI specification CLI Flags kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.split true OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 path : split : true paths : / : get : {} /books : post : {} ... Sample Output --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp-get namespace : my-namespace spec : prefix : \"/\" method : GET service : booksapp.my-service-namespace:7000 rewrite : \"\" --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp-postbooks namespace : my-namespace spec : prefix : \"/books\" method : POST service : booksapp.my-service-namespace:7000 rewrite : \"\" Base Path and Trim Prefix Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the trim prefix options will instruct ambassador to trim the prefix before sending the request onto the service. CLI Flags kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.base /my-app \\ --path.trim_prefix /my-app OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 path : base : /my-app trim_prefix : /my-app paths : / : get : {} ... Sample Output --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp namespace : my-namespace spec : prefix : \"/my-app\" service : booksapp.my-service-namespace:7000 regex_rewrite : pattern : '/my-app(.*)' substitution : '\\1' Setting timeouts kusk-gen allows for setting both idle and request timeouts via flags or the x-kusk OpenAPI extension CLI Flags kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --timeouts.idle_timeout 120 \\ --timeouts.request_timeout 120 OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 timeouts : request_timeout : 120 idle_timeout : 120 paths : / : get : {} ... Sample Output --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp namespace : my-namespace spec : prefix : \"/\" service : booksapp.my-service-namespace:7000 rewrite : \"\" timeout_ms : 120000 idle_timeout_ms : 120000 Setting the Host header kusk-gen allows for setting both idle and request timeouts via flags or the x-kusk OpenAPI extension CLI Flags kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --host \"somehost.io\" OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 host : somehost.io paths : / : get : {} ... Sample Output --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp namespace : my-namespace spec : prefix : \"/\" host : somehost.io service : booksapp.my-service-namespace:7000 rewrite : \"\" timeout_ms : 120000 idle_timeout_ms : 120000 CORS Via the x-kusk extension, you can set cors policies on your resources OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} ... Sample Output --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : webapp namespace : booksapp spec : prefix : \"/\" service : webapp.booksapp:7000 rewrite : \"\" cors : origins : http://foo.example,http://bar.example methods : POST,GET,OPTIONS headers : Content-Type exposed_headers : X-Custom-Header credentials : true max_age : \"86400\" Basic Path settings override For this example, let's assume that one of the paths in the API specification should have different CORS headers than the rest. OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} /books : x-kusk : cors : methods : - POST headers : - Other-Content-Type credentials : true expose_headers : - X-Other-Custom-Header max_age : 120 post : {} ... Sample Output --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : webapp-get namespace : booksapp spec : prefix : \"/\" method : GET service : webapp.booksapp:7000 rewrite : \"\" cors : origins : methods : POST,GET,OPTIONS headers : Content-Type exposed_headers : X-Custom-Header credentials : true max_age : \"86400\" --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : webapp-postbooks namespace : booksapp spec : prefix : \"/books\" method : POST service : webapp.booksapp:7000 rewrite : \"\" cors : origins : methods : POST headers : Other-Content-Type exposed_headers : X-Other-Custom-Header credentials : true max_age : \"120\"","title":"Ambassador 1.X"},{"location":"ambassador/#ambassador","text":"Note : Ambassador uses CustomResourceDefinition s with apiVersion = apiextensions.k8s.io/v1beta1 which was removed in Kubernetes version 1.22+. Please ensure your Kubernetes version is compatible with the version of Ambassador you're using kusk-gen ambassador --help Generates Ambassador Mappings for your service Usage: kusk-gen ambassador [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --path.base string a base path for Service endpoints ( default \"/\" ) --path.split force Kusk to generate a separate Mapping for each operation --path.trim_prefix string a prefix to trim from the URL before forwarding to the upstream Service --timeouts.idle_timeout uint32 idle connection timeout ( seconds ) --timeouts.request_timeout uint32 total request timeout ( seconds ) -h, --help help for ambassador The Ambassador generator generates Mapping resources for mapping resource to services. All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification.","title":"Ambassador"},{"location":"ambassador/#full-options-reference","text":"Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Path Trim Prefix --path.trim_prefix path.trim_prefix Trim the specified prefix from URl before passing request onto service \u274c Path split --path.split path.split Boolean; whether or not to force generator to generate a mapping for each path \u274c Host --host host The value to set the host field to in the Mapping resource \u2705 Rate limit (RPS) --rate_limits.rps rate_limits.rps Request per second rate limit \u2705 Rate limit (burst) --rate_limits.burst rate_limits.burst Rate limit burst \u2705 Rate limit group N/A rate_limits.group Rate limit endpoint group Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705 Idle Timeout --timeouts.idle_timeout timeouts.idle_timeout Idle connection timeout (seconds) \u2705 CORS Origins N/A cors.origins Array of origins \u2705 CORS Methods N/A cors.methods Array of methods \u2705 CORS Headers N/A cors.headers Array of headers \u2705 CORS ExposeHeaders N/A cors.expose_headers Array of headers to expose \u2705 CORS Credentials N/A cors.credentials Boolean: enable credentials (default value: false) \u2705 CORS Max Age N/A cors.max_age Integer:how long the response to the preflight request can be cached for without sending another preflight request \u2705 ## Basic Usage","title":"Full Options Reference"},{"location":"ambassador/#cli-flags","text":"kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace","title":"CLI Flags"},{"location":"ambassador/#openapi-specification","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador/#sample-output","text":"--- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp namespace : my-namespace spec : prefix : \"/\" service : booksapp.my-service-namespace:7000 rewrite : \"\"","title":"Sample Output"},{"location":"ambassador/#split-path","text":"By setting split path to true, kusk-gen will generate a mapping per route specified in the provided OpenAPI specification","title":"Split Path"},{"location":"ambassador/#cli-flags_1","text":"kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.split true","title":"CLI Flags"},{"location":"ambassador/#openapi-specification_1","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 path : split : true paths : / : get : {} /books : post : {} ...","title":"OpenAPI Specification"},{"location":"ambassador/#sample-output_1","text":"--- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp-get namespace : my-namespace spec : prefix : \"/\" method : GET service : booksapp.my-service-namespace:7000 rewrite : \"\" --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp-postbooks namespace : my-namespace spec : prefix : \"/books\" method : POST service : booksapp.my-service-namespace:7000 rewrite : \"\"","title":"Sample Output"},{"location":"ambassador/#base-path-and-trim-prefix","text":"Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the trim prefix options will instruct ambassador to trim the prefix before sending the request onto the service.","title":"Base Path and Trim Prefix"},{"location":"ambassador/#cli-flags_2","text":"kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.base /my-app \\ --path.trim_prefix /my-app","title":"CLI Flags"},{"location":"ambassador/#openapi-specification_2","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 path : base : /my-app trim_prefix : /my-app paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador/#sample-output_2","text":"--- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp namespace : my-namespace spec : prefix : \"/my-app\" service : booksapp.my-service-namespace:7000 regex_rewrite : pattern : '/my-app(.*)' substitution : '\\1'","title":"Sample Output"},{"location":"ambassador/#setting-timeouts","text":"kusk-gen allows for setting both idle and request timeouts via flags or the x-kusk OpenAPI extension","title":"Setting timeouts"},{"location":"ambassador/#cli-flags_3","text":"kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --timeouts.idle_timeout 120 \\ --timeouts.request_timeout 120","title":"CLI Flags"},{"location":"ambassador/#openapi-specification_3","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 timeouts : request_timeout : 120 idle_timeout : 120 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador/#sample-output_3","text":"--- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp namespace : my-namespace spec : prefix : \"/\" service : booksapp.my-service-namespace:7000 rewrite : \"\" timeout_ms : 120000 idle_timeout_ms : 120000","title":"Sample Output"},{"location":"ambassador/#setting-the-host-header","text":"kusk-gen allows for setting both idle and request timeouts via flags or the x-kusk OpenAPI extension","title":"Setting the Host header"},{"location":"ambassador/#cli-flags_4","text":"kusk-gen ambassador -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --host \"somehost.io\"","title":"CLI Flags"},{"location":"ambassador/#openapi-specification_4","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 host : somehost.io paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador/#sample-output_4","text":"--- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : booksapp namespace : my-namespace spec : prefix : \"/\" host : somehost.io service : booksapp.my-service-namespace:7000 rewrite : \"\" timeout_ms : 120000 idle_timeout_ms : 120000","title":"Sample Output"},{"location":"ambassador/#cors","text":"Via the x-kusk extension, you can set cors policies on your resources","title":"CORS"},{"location":"ambassador/#openapi-specification_5","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador/#sample-output_5","text":"--- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : webapp namespace : booksapp spec : prefix : \"/\" service : webapp.booksapp:7000 rewrite : \"\" cors : origins : http://foo.example,http://bar.example methods : POST,GET,OPTIONS headers : Content-Type exposed_headers : X-Custom-Header credentials : true max_age : \"86400\"","title":"Sample Output"},{"location":"ambassador/#basic-path-settings-override","text":"For this example, let's assume that one of the paths in the API specification should have different CORS headers than the rest.","title":"Basic Path settings override"},{"location":"ambassador/#openapi-specification_6","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} /books : x-kusk : cors : methods : - POST headers : - Other-Content-Type credentials : true expose_headers : - X-Other-Custom-Header max_age : 120 post : {} ...","title":"OpenAPI Specification"},{"location":"ambassador/#sample-output_6","text":"--- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : webapp-get namespace : booksapp spec : prefix : \"/\" method : GET service : webapp.booksapp:7000 rewrite : \"\" cors : origins : methods : POST,GET,OPTIONS headers : Content-Type exposed_headers : X-Custom-Header credentials : true max_age : \"86400\" --- apiVersion : getambassador.io/v2 kind : Mapping metadata : name : webapp-postbooks namespace : booksapp spec : prefix : \"/books\" method : POST service : webapp.booksapp:7000 rewrite : \"\" cors : origins : methods : POST headers : Other-Content-Type exposed_headers : X-Other-Custom-Header credentials : true max_age : \"120\"","title":"Sample Output"},{"location":"ambassador2/","text":"Ambassador 2.0 Note Ambassador2 uses CustomResourceDefinition s with apiVersion = apiextensions.k8s.io/v1 which is compatible with Kubernetes version 1.22+. Please ensure your Kubernetes version is compatible with the version of Ambassador you're using. kusk-gen ambassador2 --help Generates Ambassador 2 .0 Mappings for your service Usage: kusk ambassador2 [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --host string the Host header value to listen on --path.base string a base path for Service endpoints ( default \"/\" ) --path.rewrite string rewrite your base path before forwarding to the upstream service --path.split force Kusk to generate a separate Mapping for each operation --path.trim_prefix string a prefix to trim from the URL before forwarding to the upstream Service --rate_limits.burst uint32 request per second burst --rate_limits.rps uint32 request per second rate limit --timeouts.idle_timeout uint32 idle connection timeout ( seconds ) --timeouts.request_timeout uint32 total request timeout ( seconds ) -h, --help The Ambassador generator generates [Mapping]s (https://www.getambassador.io/docs/edge-stack/2.0/topics/using/intro-mappings/) resources for mapping resource to services. All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification. Full Options Reference Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Path Rewrite --path.rewrite path.rewrite Rewrite your base path before forwarding to the upstream service \u274c Path Trim Prefix --path.trim_prefix path.trim_prefix Trim the specified prefix from URl before passing request onto service \u274c Path split --path.split path.split Boolean; whether or not to force generator to generate a mapping for each path \u274c Host --host host The value to set the host field to in the Mapping resource \u2705 Rate limit (RPS) --rate_limits.rps rate_limits.rps Request per second rate limit \u2705 Rate limit (burst) --rate_limits.burst rate_limits.burst Rate limit burst \u2705 Rate limit group N/A rate_limits.group Rate limit endpoint group Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705 Idle Timeout --timeouts.idle_timeout timeouts.idle_timeout Idle connection timeout (seconds) \u2705 CORS Origins N/A cors.origins Array of origins \u2705 CORS Methods N/A cors.methods Array of methods \u2705 CORS Headers N/A cors.headers Array of headers \u2705 CORS ExposeHeaders N/A cors.expose_headers Array of headers to expose \u2705 CORS Credentials N/A cors.credentials Boolean: enable credentials (default value: false) \u2705 CORS Max Age N/A cors.max_age Integer:how long the response to the preflight request can be cached for without sending another preflight request \u2705 Ambassador 2.0 Setup source Create cluster k3d cluster create -p \"8080:80@loadbalancer\" -p \"8443:443@loadbalancer\" --k3s-server-arg '--disable=traefik' cl1 Install the edge-stack # Add the Repo: helm repo add datawire https://www.getambassador.io helm repo update kubectl create namespace emissary && \\ helm install emissary-ingress --devel --namespace emissary datawire/emissary-ingress && \\ kubectl -n emissary wait --for condition=available --timeout=90s deploy -lapp.kubernetes.io/instance=emissary-ingress Create the AmbassadorListeners kubectl apply -f - <<EOF --- apiVersion: x.getambassador.io/v3alpha1 kind: Listener metadata: name: edge-stack-listener-8080 namespace: emissary spec: port: 8080 protocol: HTTP securityModel: XFP hostBinding: namespace: from: ALL --- apiVersion: x.getambassador.io/v3alpha1 kind: Listener metadata: name: edge-stack-listener-8443 namespace: emissary spec: port: 8443 protocol: HTTPS securityModel: XFP hostBinding: namespace: from: ALL EOF Create the AmbassadorHost cat <<EOF | kubectl apply -f - --- apiVersion: x.getambassador.io/v3alpha1 kind: Host metadata: name: my-host namespace: ambassador spec: hostname: \"*\" requestPolicy: insecure: action: Redirect EOF Deploy the example booksapp kubectl create ns booksapp && \\ kubectl apply -n booksapp -f /Users/kylehodgetts/kubeshop/kusk/examples/booksapp/manifest.yaml && \\ kubectl rollout status -n booksapp deployment/webapp -w Basic Usage CLI Flags kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace booksapp OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 paths : / : get : {} ... Sample Output --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp namespace : booksapp spec : prefix : \"/\" hostname : '*' service : booksapp.booksapp:7000 rewrite : \"\" Test curl -Lki https://localhost:8443 Or go to your web browser Split Path By setting split path to true, kusk will generate a mapping per route specified in the provided OpenAPI specification CLI Flags kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace booksapp \\ --path.split true OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 path : split : true paths : / : get : {} /books : post : {} ... Sample Output --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp-get namespace : booksapp spec : prefix : \"/\" hostname : '*' method : GET service : booksapp.booksapp:7000 rewrite : \"\" --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp-postbooks namespace : booksapp spec : prefix : \"/books\" hostname : '*' method : POST service : booksapp.booksapp:7000 rewrite : \"\" Test curl -Lki https://localhost:8443 Or go to your web browser Base Path and Trim Prefix Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the trim prefix options will instruct ambassador to trim the prefix before sending the request onto the service. CLI Flags kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace booksapp \\ --path.base /my-app \\ --path.trim_prefix /my-app OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 path : base : /my-app trim_prefix : /my-app paths : / : get : {} ... Sample Output --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp namespace : booksapp spec : prefix : \"/my-app\" hostname : '*' service : booksapp.booksapp:7000 regex_rewrite : pattern : '/my-app(.*)' substitution : '\\1' Test curl -Lki https://localhost:8443/my-app/ Or go to your web browser Note the trailing / is mandatory. Base Path and Rewrite Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the rewrite option will instruct ambassador to rewrite the base path before sending the request to the upstream service When no rewrite or trim prefix is specified, the rewrite option will default to \"\" . note If you want the default ambassador behaviour for rewrites, set the rewrite option to / note trim_prefix takes precedence over rewrite. If both are defined, trim_prefix will take effect and rewrite will be ignored. CLI Flags kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace booksapp \\ --path.base /my-app \\ --path.rewrite /my-other-app OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 path : base : /my-app rewrite : /my-other-app paths : / : get : {} ... Sample Output --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp namespace : booksapp spec : prefix : \"/my-app\" hostname : '*' service : booksapp.booksapp:7000 rewrite : \"/my-other-app\" Test curl -Lki https://localhost:8443/my-app/ Or go to your web browser Note the trailing / is mandatory. Setting timeouts kusk-gen allows for setting both idle and request timeouts via flags or the x-kusk OpenAPI extension CLI Flags kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace booksapp \\ --timeouts.idle_timeout 120 \\ --timeouts.request_timeout 120 OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 timeouts : request_timeout : 120 idle_timeout : 120 paths : / : get : {} ... Sample Output --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp namespace : booksapp spec : prefix : \"/\" hostname : '*' service : booksapp.booksapp:7000 rewrite : \"\" timeout_ms : 120000 idle_timeout_ms : 120000 CORS Via the x-kusk extension, you can set cors policies on your resources kusk-gen ambassador2 -i examples/booksapp/booksapp_extension.yaml Here we only set the -i input flag as the other mandatory options have been set using the x-kusk extension in the OpenAPI spec file. OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} ... Sample Output --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : webapp namespace : booksapp spec : prefix : \"/\" hostname : '*' service : webapp.booksapp:7000 rewrite : \"\" cors : origins : - \"http://foo.example\" - \"http://bar.example\" methods : - \"POST\" - \"GET\" - \"OPTIONS\" headers : - \"Content-Type\" exposed_headers : - \"X-Custom-Header\" credentials : true max_age : \"86400\" Test curl -kI -X GET -H \"Origin: http://foo.example\" --verbose https://localhost:8443/ Basic Path settings override For this example, let's assume that one of the paths in the API specification should have different CORS headers than the rest. OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 cors : methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} /books : x-kusk : cors : methods : - POST headers : - Other-Content-Type credentials : true expose_headers : - X-Other-Custom-Header max_age : 120 post : {} ... Sample Output ---- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : webapp-get namespace : booksapp spec : prefix : \"/\" hostname : '*' method : GET service : webapp.booksapp:7000 rewrite : \"\" cors : methods : - \"POST\" - \"GET\" - \"OPTIONS\" headers : - \"Content-Type\" exposed_headers : - \"X-Custom-Header\" credentials : true max_age : \"86400\" --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : webapp-postbooks namespace : booksapp spec : prefix : \"/books\" hostname : '*' method : POST service : webapp.booksapp:7000 rewrite : \"\" cors : methods : - \"POST\" headers : - \"Other-Content-Type\" exposed_headers : - \"X-Other-Custom-Header\" credentials : true max_age : \"120\"","title":"Ambassador 2.X"},{"location":"ambassador2/#ambassador-20","text":"Note Ambassador2 uses CustomResourceDefinition s with apiVersion = apiextensions.k8s.io/v1 which is compatible with Kubernetes version 1.22+. Please ensure your Kubernetes version is compatible with the version of Ambassador you're using. kusk-gen ambassador2 --help Generates Ambassador 2 .0 Mappings for your service Usage: kusk ambassador2 [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --host string the Host header value to listen on --path.base string a base path for Service endpoints ( default \"/\" ) --path.rewrite string rewrite your base path before forwarding to the upstream service --path.split force Kusk to generate a separate Mapping for each operation --path.trim_prefix string a prefix to trim from the URL before forwarding to the upstream Service --rate_limits.burst uint32 request per second burst --rate_limits.rps uint32 request per second rate limit --timeouts.idle_timeout uint32 idle connection timeout ( seconds ) --timeouts.request_timeout uint32 total request timeout ( seconds ) -h, --help The Ambassador generator generates [Mapping]s (https://www.getambassador.io/docs/edge-stack/2.0/topics/using/intro-mappings/) resources for mapping resource to services. All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification.","title":"Ambassador 2.0"},{"location":"ambassador2/#full-options-reference","text":"Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Path Rewrite --path.rewrite path.rewrite Rewrite your base path before forwarding to the upstream service \u274c Path Trim Prefix --path.trim_prefix path.trim_prefix Trim the specified prefix from URl before passing request onto service \u274c Path split --path.split path.split Boolean; whether or not to force generator to generate a mapping for each path \u274c Host --host host The value to set the host field to in the Mapping resource \u2705 Rate limit (RPS) --rate_limits.rps rate_limits.rps Request per second rate limit \u2705 Rate limit (burst) --rate_limits.burst rate_limits.burst Rate limit burst \u2705 Rate limit group N/A rate_limits.group Rate limit endpoint group Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705 Idle Timeout --timeouts.idle_timeout timeouts.idle_timeout Idle connection timeout (seconds) \u2705 CORS Origins N/A cors.origins Array of origins \u2705 CORS Methods N/A cors.methods Array of methods \u2705 CORS Headers N/A cors.headers Array of headers \u2705 CORS ExposeHeaders N/A cors.expose_headers Array of headers to expose \u2705 CORS Credentials N/A cors.credentials Boolean: enable credentials (default value: false) \u2705 CORS Max Age N/A cors.max_age Integer:how long the response to the preflight request can be cached for without sending another preflight request \u2705","title":"Full Options Reference"},{"location":"ambassador2/#ambassador-20-setup","text":"source","title":"Ambassador 2.0 Setup"},{"location":"ambassador2/#create-cluster","text":"k3d cluster create -p \"8080:80@loadbalancer\" -p \"8443:443@loadbalancer\" --k3s-server-arg '--disable=traefik' cl1","title":"Create cluster"},{"location":"ambassador2/#install-the-edge-stack","text":"# Add the Repo: helm repo add datawire https://www.getambassador.io helm repo update kubectl create namespace emissary && \\ helm install emissary-ingress --devel --namespace emissary datawire/emissary-ingress && \\ kubectl -n emissary wait --for condition=available --timeout=90s deploy -lapp.kubernetes.io/instance=emissary-ingress","title":"Install the edge-stack"},{"location":"ambassador2/#create-the-ambassadorlisteners","text":"kubectl apply -f - <<EOF --- apiVersion: x.getambassador.io/v3alpha1 kind: Listener metadata: name: edge-stack-listener-8080 namespace: emissary spec: port: 8080 protocol: HTTP securityModel: XFP hostBinding: namespace: from: ALL --- apiVersion: x.getambassador.io/v3alpha1 kind: Listener metadata: name: edge-stack-listener-8443 namespace: emissary spec: port: 8443 protocol: HTTPS securityModel: XFP hostBinding: namespace: from: ALL EOF","title":"Create the AmbassadorListeners"},{"location":"ambassador2/#create-the-ambassadorhost","text":"cat <<EOF | kubectl apply -f - --- apiVersion: x.getambassador.io/v3alpha1 kind: Host metadata: name: my-host namespace: ambassador spec: hostname: \"*\" requestPolicy: insecure: action: Redirect EOF","title":"Create the AmbassadorHost"},{"location":"ambassador2/#deploy-the-example-booksapp","text":"kubectl create ns booksapp && \\ kubectl apply -n booksapp -f /Users/kylehodgetts/kubeshop/kusk/examples/booksapp/manifest.yaml && \\ kubectl rollout status -n booksapp deployment/webapp -w","title":"Deploy the example booksapp"},{"location":"ambassador2/#basic-usage","text":"","title":"Basic Usage"},{"location":"ambassador2/#cli-flags","text":"kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace booksapp","title":"CLI Flags"},{"location":"ambassador2/#openapi-specification","text":"openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador2/#sample-output","text":"--- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp namespace : booksapp spec : prefix : \"/\" hostname : '*' service : booksapp.booksapp:7000 rewrite : \"\"","title":"Sample Output"},{"location":"ambassador2/#test","text":"curl -Lki https://localhost:8443 Or go to your web browser","title":"Test"},{"location":"ambassador2/#split-path","text":"By setting split path to true, kusk will generate a mapping per route specified in the provided OpenAPI specification","title":"Split Path"},{"location":"ambassador2/#cli-flags_1","text":"kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace booksapp \\ --path.split true","title":"CLI Flags"},{"location":"ambassador2/#openapi-specification_1","text":"openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 path : split : true paths : / : get : {} /books : post : {} ...","title":"OpenAPI Specification"},{"location":"ambassador2/#sample-output_1","text":"--- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp-get namespace : booksapp spec : prefix : \"/\" hostname : '*' method : GET service : booksapp.booksapp:7000 rewrite : \"\" --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp-postbooks namespace : booksapp spec : prefix : \"/books\" hostname : '*' method : POST service : booksapp.booksapp:7000 rewrite : \"\"","title":"Sample Output"},{"location":"ambassador2/#test_1","text":"curl -Lki https://localhost:8443 Or go to your web browser","title":"Test"},{"location":"ambassador2/#base-path-and-trim-prefix","text":"Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the trim prefix options will instruct ambassador to trim the prefix before sending the request onto the service.","title":"Base Path and Trim Prefix"},{"location":"ambassador2/#cli-flags_2","text":"kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace booksapp \\ --path.base /my-app \\ --path.trim_prefix /my-app","title":"CLI Flags"},{"location":"ambassador2/#openapi-specification_2","text":"openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 path : base : /my-app trim_prefix : /my-app paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador2/#sample-output_2","text":"--- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp namespace : booksapp spec : prefix : \"/my-app\" hostname : '*' service : booksapp.booksapp:7000 regex_rewrite : pattern : '/my-app(.*)' substitution : '\\1'","title":"Sample Output"},{"location":"ambassador2/#test_2","text":"curl -Lki https://localhost:8443/my-app/ Or go to your web browser Note the trailing / is mandatory.","title":"Test"},{"location":"ambassador2/#base-path-and-rewrite","text":"Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the rewrite option will instruct ambassador to rewrite the base path before sending the request to the upstream service When no rewrite or trim prefix is specified, the rewrite option will default to \"\" . note If you want the default ambassador behaviour for rewrites, set the rewrite option to / note trim_prefix takes precedence over rewrite. If both are defined, trim_prefix will take effect and rewrite will be ignored.","title":"Base Path and Rewrite"},{"location":"ambassador2/#cli-flags_3","text":"kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace booksapp \\ --path.base /my-app \\ --path.rewrite /my-other-app","title":"CLI Flags"},{"location":"ambassador2/#openapi-specification_3","text":"openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 path : base : /my-app rewrite : /my-other-app paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador2/#sample-output_3","text":"--- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp namespace : booksapp spec : prefix : \"/my-app\" hostname : '*' service : booksapp.booksapp:7000 rewrite : \"/my-other-app\"","title":"Sample Output"},{"location":"ambassador2/#test_3","text":"curl -Lki https://localhost:8443/my-app/ Or go to your web browser Note the trailing / is mandatory.","title":"Test"},{"location":"ambassador2/#setting-timeouts","text":"kusk-gen allows for setting both idle and request timeouts via flags or the x-kusk OpenAPI extension","title":"Setting timeouts"},{"location":"ambassador2/#cli-flags_4","text":"kusk-gen ambassador2 -i examples/booksapp/booksapp.yaml \\ --namespace booksapp \\ --host \"*\" \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace booksapp \\ --timeouts.idle_timeout 120 \\ --timeouts.request_timeout 120","title":"CLI Flags"},{"location":"ambassador2/#openapi-specification_4","text":"openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 timeouts : request_timeout : 120 idle_timeout : 120 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador2/#sample-output_4","text":"--- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : booksapp namespace : booksapp spec : prefix : \"/\" hostname : '*' service : booksapp.booksapp:7000 rewrite : \"\" timeout_ms : 120000 idle_timeout_ms : 120000","title":"Sample Output"},{"location":"ambassador2/#cors","text":"Via the x-kusk extension, you can set cors policies on your resources kusk-gen ambassador2 -i examples/booksapp/booksapp_extension.yaml Here we only set the -i input flag as the other mandatory options have been set using the x-kusk extension in the OpenAPI spec file.","title":"CORS"},{"location":"ambassador2/#openapi-specification_5","text":"openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ambassador2/#sample-output_5","text":"--- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : webapp namespace : booksapp spec : prefix : \"/\" hostname : '*' service : webapp.booksapp:7000 rewrite : \"\" cors : origins : - \"http://foo.example\" - \"http://bar.example\" methods : - \"POST\" - \"GET\" - \"OPTIONS\" headers : - \"Content-Type\" exposed_headers : - \"X-Custom-Header\" credentials : true max_age : \"86400\"","title":"Sample Output"},{"location":"ambassador2/#test_4","text":"curl -kI -X GET -H \"Origin: http://foo.example\" --verbose https://localhost:8443/","title":"Test"},{"location":"ambassador2/#basic-path-settings-override","text":"For this example, let's assume that one of the paths in the API specification should have different CORS headers than the rest.","title":"Basic Path settings override"},{"location":"ambassador2/#openapi-specification_6","text":"openapi : 3.0.1 x-kusk : namespace : booksapp host : \"*\" service : name : webapp namespace : booksapp port : 7000 cors : methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} /books : x-kusk : cors : methods : - POST headers : - Other-Content-Type credentials : true expose_headers : - X-Other-Custom-Header max_age : 120 post : {} ...","title":"OpenAPI Specification"},{"location":"ambassador2/#sample-output_6","text":"---- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : webapp-get namespace : booksapp spec : prefix : \"/\" hostname : '*' method : GET service : webapp.booksapp:7000 rewrite : \"\" cors : methods : - \"POST\" - \"GET\" - \"OPTIONS\" headers : - \"Content-Type\" exposed_headers : - \"X-Custom-Header\" credentials : true max_age : \"86400\" --- apiVersion : x.getambassador.io/v3alpha1 kind : Mapping metadata : name : webapp-postbooks namespace : booksapp spec : prefix : \"/books\" hostname : '*' method : POST service : webapp.booksapp:7000 rewrite : \"\" cors : methods : - \"POST\" headers : - \"Other-Content-Type\" exposed_headers : - \"X-Other-Custom-Header\" credentials : true max_age : \"120\"","title":"Sample Output"},{"location":"argocd/","text":"ArgoCD It is possible to make your OpenAPI schema the real source of truth for your K8s configurations with Kusk - by using it as an ArgoCD's custom tool ! GitOps approach will allow you to use ArgoCD to automatically generate configurations in a determinative way based off your OpenAPI schema that you can store in Git to easily version, review and rollback your APIs. ArgoCD will take care of automatically syncing your configurations, while Kusk will happily generate it for you every time you make a change. This guide will help you setup Kusk in ArgoCD. Table of Contents Prerequisites Install Kusk as a custom tool Use Kusk in ArgoCD UI Use Kusk in ArgoCD CLI Use Kusk in ArgoCD App manifest Prerequisites Have a working ArgoCD installation - ArgoCD quick start . Have a repository with OpenAPI schema configured within ArgoCD - for this example we will use Kusk's example folder . Install Kusk as a custom tool To install a custom tool in ArgoCD, we will follow the official guide . We will add an initContainer to argocd-repo-server and a volume to download Kusk's binary to: --- a/argocd-repo-server.yaml +++ b/argocd-repo-server.yaml @@ -31,6 +31,16 @@ spec: topologyKey: kubernetes.io/hostname weight: 5 automountServiceAccountToken: false + initContainers: + - name: download-kusk-gen + image: alpine:3.8 + command: [ sh, -c ] + args: + - wget -qO- https://github.com/kubeshop/kusk-gen/releases/latest/download/kusk-gen_Linux_arm64.tar.gz | tar -xvzf - && + mv kusk /custom-tools/ + volumeMounts: + - mountPath: /custom-tools + name: kusk-gen containers: - command: - uid_entrypoint.sh @@ -72,7 +82,12 @@ spec: name: gpg-keyring - mountPath: /app/config/reposerver/tls name: argocd-repo-server-tls + - mountPath: /usr/local/bin/kusk-gen + name: kusk-gen + subPath: kusk-gen volumes: + - name: kusk-gen + emptyDir: {} - configMap: name: argocd-ssh-known-hosts-cm name: ssh-known-hosts When installed, Kusk binary will be available during ArgoCD sync. To use that, we'll register a configuration management plugin : --- a/argocd-cm.yaml +++ b/argocd-cm.yaml @@ -5,3 +5,9 @@ metadata: app.kubernetes.io/name: argocd-cm app.kubernetes.io/part-of: argocd name: argocd-cm +data: + configManagementPlugins: | + - name: kusk-gen + generate: + command: [\"/bin/sh\", \"-c\"] + args: [\"kusk-gen $KUSK_GENERATOR -i $KUSK_INPUT $KUSK_ARGS\"] Once these changes are applied to your ArgoCD installation, you can begin to use Kusk! Use kusk-gen in ArgoCD UI When you are creating an App via UI , scroll down and select \"Plugin\" as a configuration management tool: After that, select kusk-gen as a plugin and fill the environment variables to specify the generator you want to invoke and the input file with your OpenAPI schema: ArgoCD will sync your app and you will be able to see resources generated and applied to your cluster automatically \ud83e\ude84: Use kusk-gen in ArgoCD CLI It is also possible to create an App via CLI with Kusk - just specify --config-management-plugin kusk option: argocd app create petstore-kusk \\ --config-management-plugin kusk \\ --plugin-env KUSK_GENERATOR = ambassador \\ --plugin-env KUSK_INPUT = petstore_extension.yaml \\ --repo https://github.com/kubeshop/kusk-gen \\ --path examples/petstore \\ --dest-server https://kubernetes.default.svc \\ --dest-namespace default Use kusk-gen in ArgoCD App manifest In ArgoCD it is possible to manage applications using App manifest and apply them using kubectl : documentation . To use Kusk in this setup, add Kusk in a plugin node: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : name : petstore-kusk spec : destination : namespace : default server : 'https://kubernetes.default.svc' source : path : examples/petstore repoURL : 'https://github.com/kubeshop/kusk-gen' targetRevision : main plugin : name : kusk env : - name : KUSK_INPUT value : petstore_extension.yaml - name : KUSK_GENERATOR value : ambassador project : default syncPolicy : automated : prune : true selfHeal : true","title":"Using with ArgoCD"},{"location":"argocd/#argocd","text":"It is possible to make your OpenAPI schema the real source of truth for your K8s configurations with Kusk - by using it as an ArgoCD's custom tool ! GitOps approach will allow you to use ArgoCD to automatically generate configurations in a determinative way based off your OpenAPI schema that you can store in Git to easily version, review and rollback your APIs. ArgoCD will take care of automatically syncing your configurations, while Kusk will happily generate it for you every time you make a change. This guide will help you setup Kusk in ArgoCD.","title":"ArgoCD"},{"location":"argocd/#table-of-contents","text":"Prerequisites Install Kusk as a custom tool Use Kusk in ArgoCD UI Use Kusk in ArgoCD CLI Use Kusk in ArgoCD App manifest","title":"Table of Contents"},{"location":"argocd/#prerequisites","text":"Have a working ArgoCD installation - ArgoCD quick start . Have a repository with OpenAPI schema configured within ArgoCD - for this example we will use Kusk's example folder .","title":"Prerequisites"},{"location":"argocd/#install-kusk-as-a-custom-tool","text":"To install a custom tool in ArgoCD, we will follow the official guide . We will add an initContainer to argocd-repo-server and a volume to download Kusk's binary to: --- a/argocd-repo-server.yaml +++ b/argocd-repo-server.yaml @@ -31,6 +31,16 @@ spec: topologyKey: kubernetes.io/hostname weight: 5 automountServiceAccountToken: false + initContainers: + - name: download-kusk-gen + image: alpine:3.8 + command: [ sh, -c ] + args: + - wget -qO- https://github.com/kubeshop/kusk-gen/releases/latest/download/kusk-gen_Linux_arm64.tar.gz | tar -xvzf - && + mv kusk /custom-tools/ + volumeMounts: + - mountPath: /custom-tools + name: kusk-gen containers: - command: - uid_entrypoint.sh @@ -72,7 +82,12 @@ spec: name: gpg-keyring - mountPath: /app/config/reposerver/tls name: argocd-repo-server-tls + - mountPath: /usr/local/bin/kusk-gen + name: kusk-gen + subPath: kusk-gen volumes: + - name: kusk-gen + emptyDir: {} - configMap: name: argocd-ssh-known-hosts-cm name: ssh-known-hosts When installed, Kusk binary will be available during ArgoCD sync. To use that, we'll register a configuration management plugin : --- a/argocd-cm.yaml +++ b/argocd-cm.yaml @@ -5,3 +5,9 @@ metadata: app.kubernetes.io/name: argocd-cm app.kubernetes.io/part-of: argocd name: argocd-cm +data: + configManagementPlugins: | + - name: kusk-gen + generate: + command: [\"/bin/sh\", \"-c\"] + args: [\"kusk-gen $KUSK_GENERATOR -i $KUSK_INPUT $KUSK_ARGS\"] Once these changes are applied to your ArgoCD installation, you can begin to use Kusk!","title":"Install Kusk as a custom tool"},{"location":"argocd/#use-kusk-gen-in-argocd-ui","text":"When you are creating an App via UI , scroll down and select \"Plugin\" as a configuration management tool: After that, select kusk-gen as a plugin and fill the environment variables to specify the generator you want to invoke and the input file with your OpenAPI schema: ArgoCD will sync your app and you will be able to see resources generated and applied to your cluster automatically \ud83e\ude84:","title":"Use kusk-gen in ArgoCD UI"},{"location":"argocd/#use-kusk-gen-in-argocd-cli","text":"It is also possible to create an App via CLI with Kusk - just specify --config-management-plugin kusk option: argocd app create petstore-kusk \\ --config-management-plugin kusk \\ --plugin-env KUSK_GENERATOR = ambassador \\ --plugin-env KUSK_INPUT = petstore_extension.yaml \\ --repo https://github.com/kubeshop/kusk-gen \\ --path examples/petstore \\ --dest-server https://kubernetes.default.svc \\ --dest-namespace default","title":"Use kusk-gen in ArgoCD CLI"},{"location":"argocd/#use-kusk-gen-in-argocd-app-manifest","text":"In ArgoCD it is possible to manage applications using App manifest and apply them using kubectl : documentation . To use Kusk in this setup, add Kusk in a plugin node: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : name : petstore-kusk spec : destination : namespace : default server : 'https://kubernetes.default.svc' source : path : examples/petstore repoURL : 'https://github.com/kubeshop/kusk-gen' targetRevision : main plugin : name : kusk env : - name : KUSK_INPUT value : petstore_extension.yaml - name : KUSK_GENERATOR value : ambassador project : default syncPolicy : automated : prune : true selfHeal : true","title":"Use kusk-gen in ArgoCD App manifest"},{"location":"development/","text":"For Developers Checkout our Github actions for how we build and test the code here Clone this repository and navigate inside the project folder and install the dependencies by running: go get -d ./... You can also just compile the project (and its dependencies) by running: go build or run the project directly: go run main.go To run the tests: go test ./... Adding a custom generator To add a generator for a tool not yet supported by Kusk one would need to implement generators.Interface and register it's implementation by adding an element to generators.Registry . The CLI command would be constructed automatically and the parsed OpenAPI spec would be passed into the generator, along with path/method options extracted from x-kusk extension. The CLI options provided by the generator must conform to the same naming scheme as JSON/YAML tags on options passed from x-kusk extension for automatic merge to work. Check out generators folder and Options for the examples. If you want to contribute Check out our Contributor Guide and Code of Conduct Fork/Clone the repo and make sure you can run it as shown above Check out open issues here on GitHub Get in touch with the team by starting a discussion on what you want to help with or open an issue of your own that you would like to contribute to the project. Fly like the wind!","title":"For Developers"},{"location":"development/#for-developers","text":"Checkout our Github actions for how we build and test the code here Clone this repository and navigate inside the project folder and install the dependencies by running: go get -d ./... You can also just compile the project (and its dependencies) by running: go build or run the project directly: go run main.go To run the tests: go test ./...","title":"For Developers"},{"location":"development/#adding-a-custom-generator","text":"To add a generator for a tool not yet supported by Kusk one would need to implement generators.Interface and register it's implementation by adding an element to generators.Registry . The CLI command would be constructed automatically and the parsed OpenAPI spec would be passed into the generator, along with path/method options extracted from x-kusk extension. The CLI options provided by the generator must conform to the same naming scheme as JSON/YAML tags on options passed from x-kusk extension for automatic merge to work. Check out generators folder and Options for the examples.","title":"Adding a custom generator"},{"location":"development/#if-you-want-to-contribute","text":"Check out our Contributor Guide and Code of Conduct Fork/Clone the repo and make sure you can run it as shown above Check out open issues here on GitHub Get in touch with the team by starting a discussion on what you want to help with or open an issue of your own that you would like to contribute to the project. Fly like the wind!","title":"If you want to contribute"},{"location":"getting-started/","text":"Getting Started Installing Kusk Homebrew brew install kubeshop/kusk/kusk-gen Latest release on Github go install github.com/kubeshop/kusk-gen@$VERSION If you don't want to build it yourself, the Releases page contains already built binaries for all supported platforms. Download it and unpack kusk to the directory of you choice. From source git clone git@github.com:kubeshop/kusk-gen.git && \\ cd kusk-gen && \\ go install Usage For a run-through of what kusk-gen can do with the tools already installed in your cluster run: kusk-gen wizard -i my-openapi-spec.yaml Or use one of our examples kusk-gen wizard -i examples/booksapp/booksapp.yaml Usage: kusk-gen [ command ] Available Commands: ambassador Generates Ambassador Mappings for your service completion generate the autocompletion script for the specified shell help Help about any command linkerd Generates Linkerd Service Profiles for your service ingress-nginx Generates ingress-nginx resources traefik Generates Traefik resources wizard Connects to current Kubernetes cluster and lists available generators Flags: -h, --help help for kusk Use \"kusk-gen [command] --help\" for more information about a command. For more comprehensive instructions on individual generators, please refer to the dedicated document in the docs folder for that generator.","title":"Getting Started"},{"location":"getting-started/#getting-started","text":"","title":"Getting Started"},{"location":"getting-started/#installing-kusk","text":"","title":"Installing Kusk"},{"location":"getting-started/#homebrew","text":"brew install kubeshop/kusk/kusk-gen","title":"Homebrew"},{"location":"getting-started/#latest-release-on-github","text":"go install github.com/kubeshop/kusk-gen@$VERSION If you don't want to build it yourself, the Releases page contains already built binaries for all supported platforms. Download it and unpack kusk to the directory of you choice.","title":"Latest release on Github"},{"location":"getting-started/#from-source","text":"git clone git@github.com:kubeshop/kusk-gen.git && \\ cd kusk-gen && \\ go install","title":"From source"},{"location":"getting-started/#usage","text":"For a run-through of what kusk-gen can do with the tools already installed in your cluster run: kusk-gen wizard -i my-openapi-spec.yaml Or use one of our examples kusk-gen wizard -i examples/booksapp/booksapp.yaml Usage: kusk-gen [ command ] Available Commands: ambassador Generates Ambassador Mappings for your service completion generate the autocompletion script for the specified shell help Help about any command linkerd Generates Linkerd Service Profiles for your service ingress-nginx Generates ingress-nginx resources traefik Generates Traefik resources wizard Connects to current Kubernetes cluster and lists available generators Flags: -h, --help help for kusk Use \"kusk-gen [command] --help\" for more information about a command. For more comprehensive instructions on individual generators, please refer to the dedicated document in the docs folder for that generator.","title":"Usage"},{"location":"ingress-nginx/","text":"Ingress Nginx Note This generator refers to the community ingress from Kubernetes ingress-nginx kusk-gen ingress-nginx Usage: kusk ingress-nginx [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --host string an Ingress Host to listen on --timeouts.request_timeout uint32 total request timeout ( seconds ) --nginx_ingress.rewrite_target string a custom NGINX rewrite target --path.base string a base path for Service endpoints ( default \"/\" ) --path.trim_prefix string a prefix to trim from the URL before forwarding to the upstream Service -h, --help help for ingress-nginx The ingress-nginx generator generates Ingress resources for exposing HTTP and HTTPS routes from outside the cluster to services within the cluster. All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification.\u00df Full Options Reference Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Path Trim Prefix --path.trim_prefix path.trim_prefix Trim the specified prefix from URl before passing request onto service \u274c Path split --path.split path.split Boolean; whether or not to force generator to generate a mapping for each path \u274c Ingress Host --host host The value to set the host field to in the Ingress resource \u274c Nginx Ingress Rewrite Target --nginx_ingress.rewrite_target nginx_ingress.rewrite_target Manually set the rewrite target for where traffic must be redirected \u274c Rate limit (RPS) --rate_limits.rps rate_limits.rps Request per second rate limit \u2705 Rate limit (burst) --rate_limits.burst rate_limits.burst Rate limit burst \u2705 Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705 Idle Timeout --timeouts.idle_timeout timeouts.idle_timeout Idle connection timeout (seconds) \u2705 CORS Origins N/A cors.origins Array of origins \u2705 CORS Methods N/A cors.methods Array of methods \u2705 CORS Headers N/A cors.headers Array of headers \u2705 CORS ExposeHeaders N/A cors.expose_headers Array of headers to expose \u2705 CORS Credentials N/A cors.credentials Boolean: enable credentials (default value: false) \u2705 CORS Max Age N/A cors.max_age Integer:how long the response to the preflight request can be cached for without sending another preflight request \u2705 ## Basic Usage ### CLI Flags kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 paths : / : get : {} ... Sample Output --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {} Split Path By setting split path to true, kusk will generate an Ingress per route specified in the provided OpenAPI specification CLI Flags kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.split true OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 path : split : true paths : / : get : {} /books : post : {} ... Sample Output --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : creationTimestamp : null name : books namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : /books pathType : Exact status : loadBalancer : {} --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : creationTimestamp : null name : webapp-ingress namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {} Base Path and Trim Prefix Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the trim prefix options will instruct ambassador to trim the prefix before sending the request onto the service. CLI Flags kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.base /my-app \\ --path.trim_prefix /my-app OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 path : base : /my-app trim_prefix : /my-app paths : / : get : {} ... Sample Output --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/rewrite-target : /$2 creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : /my-app(/|$)(.*) pathType : Prefix status : loadBalancer : {} Setting the rewrite target CLI Flags kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --nginx_ingress.rewrite_target /sometarget OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace nginx_ingress : rewrite_target : /sometarget service : name : webapp namespace : my-service-namespace port : 7000 paths : / : get : {} ... Sample Output --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/rewrite-target : /sometarget creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {} Setting the Host CLI Flags kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --host mycustomhost.com OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 host : mycustomhost.com paths : / : get : {} ... Sample Output --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - host : mycustomhost.com http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {} Setting timeouts kusk-gen allows for setting a request timeout via flags or the x-kusk OpenAPI extension The ingress-nginx generator will spread the total request time over the following settings, diving it by 2 - nginx.ingress.kubernetes.io/proxy-send-timeout - nginx.ingress.kubernetes.io/proxy-read-timeout CLI Flags kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --timeouts.request_timeout 120 OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 timeouts : request_timeout : 120 paths : / : get : {} ... Sample Output --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/proxy-read-timeout : \"60\" nginx.ingress.kubernetes.io/proxy-send-timeout : \"60\" creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {} CORS Via the x-kusk extension, you can set cors policies on your resources. Due to a limitation of the ingress-nginx controller, we can only choose a single origin (the first one) from cors.origins . Kusk logs a warning informing you of this. OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} ... Sample Output --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/cors-allow-headers : Content-Type nginx.ingress.kubernetes.io/cors-allow-methods : POST, GET, OPTIONS nginx.ingress.kubernetes.io/cors-allow-origin : http://foo.example nginx.ingress.kubernetes.io/cors-expose-headers : X-Custom-Header nginx.ingress.kubernetes.io/cors-max-age : \"86400\" nginx.ingress.kubernetes.io/enable-cors : \"true\" creationTimestamp : null name : webapp-ingress namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {} Basic Path settings override For this example, let's assume that one of the paths in the API specification should have different CORS headers than the rest. OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} /books : x-kusk : cors : methods : - POST headers : - Other-Content-Type credentials : true expose_headers : - X-Other-Custom-Header max_age : 120 post : {} ... Sample Output --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/cors-allow-headers : Other-Content-Type nginx.ingress.kubernetes.io/cors-allow-methods : POST nginx.ingress.kubernetes.io/cors-expose-headers : X-Other-Custom-Header nginx.ingress.kubernetes.io/cors-max-age : \"120\" nginx.ingress.kubernetes.io/enable-cors : \"true\" creationTimestamp : null name : books namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : /books pathType : Exact status : loadBalancer : {} --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/cors-allow-headers : Content-Type nginx.ingress.kubernetes.io/cors-allow-methods : POST, GET, OPTIONS nginx.ingress.kubernetes.io/cors-expose-headers : X-Custom-Header nginx.ingress.kubernetes.io/cors-max-age : \"86400\" nginx.ingress.kubernetes.io/enable-cors : \"true\" creationTimestamp : null name : webapp-ingress namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {}","title":"Ingress-Nginx"},{"location":"ingress-nginx/#ingress-nginx","text":"Note This generator refers to the community ingress from Kubernetes ingress-nginx kusk-gen ingress-nginx Usage: kusk ingress-nginx [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --host string an Ingress Host to listen on --timeouts.request_timeout uint32 total request timeout ( seconds ) --nginx_ingress.rewrite_target string a custom NGINX rewrite target --path.base string a base path for Service endpoints ( default \"/\" ) --path.trim_prefix string a prefix to trim from the URL before forwarding to the upstream Service -h, --help help for ingress-nginx The ingress-nginx generator generates Ingress resources for exposing HTTP and HTTPS routes from outside the cluster to services within the cluster. All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification.\u00df","title":"Ingress Nginx"},{"location":"ingress-nginx/#full-options-reference","text":"Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Path Trim Prefix --path.trim_prefix path.trim_prefix Trim the specified prefix from URl before passing request onto service \u274c Path split --path.split path.split Boolean; whether or not to force generator to generate a mapping for each path \u274c Ingress Host --host host The value to set the host field to in the Ingress resource \u274c Nginx Ingress Rewrite Target --nginx_ingress.rewrite_target nginx_ingress.rewrite_target Manually set the rewrite target for where traffic must be redirected \u274c Rate limit (RPS) --rate_limits.rps rate_limits.rps Request per second rate limit \u2705 Rate limit (burst) --rate_limits.burst rate_limits.burst Rate limit burst \u2705 Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705 Idle Timeout --timeouts.idle_timeout timeouts.idle_timeout Idle connection timeout (seconds) \u2705 CORS Origins N/A cors.origins Array of origins \u2705 CORS Methods N/A cors.methods Array of methods \u2705 CORS Headers N/A cors.headers Array of headers \u2705 CORS ExposeHeaders N/A cors.expose_headers Array of headers to expose \u2705 CORS Credentials N/A cors.credentials Boolean: enable credentials (default value: false) \u2705 CORS Max Age N/A cors.max_age Integer:how long the response to the preflight request can be cached for without sending another preflight request \u2705 ## Basic Usage ### CLI Flags kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace","title":"Full Options Reference"},{"location":"ingress-nginx/#openapi-specification","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ingress-nginx/#sample-output","text":"--- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {}","title":"Sample Output"},{"location":"ingress-nginx/#split-path","text":"By setting split path to true, kusk will generate an Ingress per route specified in the provided OpenAPI specification","title":"Split Path"},{"location":"ingress-nginx/#cli-flags","text":"kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name booksapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.split true","title":"CLI Flags"},{"location":"ingress-nginx/#openapi-specification_1","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 path : split : true paths : / : get : {} /books : post : {} ...","title":"OpenAPI Specification"},{"location":"ingress-nginx/#sample-output_1","text":"--- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : creationTimestamp : null name : books namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : /books pathType : Exact status : loadBalancer : {} --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : creationTimestamp : null name : webapp-ingress namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {}","title":"Sample Output"},{"location":"ingress-nginx/#base-path-and-trim-prefix","text":"Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the trim prefix options will instruct ambassador to trim the prefix before sending the request onto the service.","title":"Base Path and Trim Prefix"},{"location":"ingress-nginx/#cli-flags_1","text":"kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.base /my-app \\ --path.trim_prefix /my-app","title":"CLI Flags"},{"location":"ingress-nginx/#openapi-specification_2","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 path : base : /my-app trim_prefix : /my-app paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ingress-nginx/#sample-output_2","text":"--- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/rewrite-target : /$2 creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : /my-app(/|$)(.*) pathType : Prefix status : loadBalancer : {}","title":"Sample Output"},{"location":"ingress-nginx/#setting-the-rewrite-target","text":"","title":"Setting the rewrite target"},{"location":"ingress-nginx/#cli-flags_2","text":"kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --nginx_ingress.rewrite_target /sometarget","title":"CLI Flags"},{"location":"ingress-nginx/#openapi-specification_3","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace nginx_ingress : rewrite_target : /sometarget service : name : webapp namespace : my-service-namespace port : 7000 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ingress-nginx/#sample-output_3","text":"--- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/rewrite-target : /sometarget creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {}","title":"Sample Output"},{"location":"ingress-nginx/#setting-the-host","text":"","title":"Setting the Host"},{"location":"ingress-nginx/#cli-flags_3","text":"kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --host mycustomhost.com","title":"CLI Flags"},{"location":"ingress-nginx/#openapi-specification_4","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 host : mycustomhost.com paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ingress-nginx/#sample-output_4","text":"--- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - host : mycustomhost.com http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {}","title":"Sample Output"},{"location":"ingress-nginx/#setting-timeouts","text":"kusk-gen allows for setting a request timeout via flags or the x-kusk OpenAPI extension The ingress-nginx generator will spread the total request time over the following settings, diving it by 2 - nginx.ingress.kubernetes.io/proxy-send-timeout - nginx.ingress.kubernetes.io/proxy-read-timeout","title":"Setting timeouts"},{"location":"ingress-nginx/#cli-flags_4","text":"kusk-gen ingress-nginx -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --timeouts.request_timeout 120","title":"CLI Flags"},{"location":"ingress-nginx/#openapi-specification_5","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 timeouts : request_timeout : 120 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ingress-nginx/#sample-output_5","text":"--- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/proxy-read-timeout : \"60\" nginx.ingress.kubernetes.io/proxy-send-timeout : \"60\" creationTimestamp : null name : webapp-ingress namespace : my-namespace spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {}","title":"Sample Output"},{"location":"ingress-nginx/#cors","text":"Via the x-kusk extension, you can set cors policies on your resources. Due to a limitation of the ingress-nginx controller, we can only choose a single origin (the first one) from cors.origins . Kusk logs a warning informing you of this.","title":"CORS"},{"location":"ingress-nginx/#openapi-specification_6","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"ingress-nginx/#sample-output_6","text":"--- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/cors-allow-headers : Content-Type nginx.ingress.kubernetes.io/cors-allow-methods : POST, GET, OPTIONS nginx.ingress.kubernetes.io/cors-allow-origin : http://foo.example nginx.ingress.kubernetes.io/cors-expose-headers : X-Custom-Header nginx.ingress.kubernetes.io/cors-max-age : \"86400\" nginx.ingress.kubernetes.io/enable-cors : \"true\" creationTimestamp : null name : webapp-ingress namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {}","title":"Sample Output"},{"location":"ingress-nginx/#basic-path-settings-override","text":"For this example, let's assume that one of the paths in the API specification should have different CORS headers than the rest.","title":"Basic Path settings override"},{"location":"ingress-nginx/#openapi-specification_7","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} /books : x-kusk : cors : methods : - POST headers : - Other-Content-Type credentials : true expose_headers : - X-Other-Custom-Header max_age : 120 post : {} ...","title":"OpenAPI Specification"},{"location":"ingress-nginx/#sample-output_7","text":"--- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/cors-allow-headers : Other-Content-Type nginx.ingress.kubernetes.io/cors-allow-methods : POST nginx.ingress.kubernetes.io/cors-expose-headers : X-Other-Custom-Header nginx.ingress.kubernetes.io/cors-max-age : \"120\" nginx.ingress.kubernetes.io/enable-cors : \"true\" creationTimestamp : null name : books namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : /books pathType : Exact status : loadBalancer : {} --- apiVersion : networking.k8s.io/v1 kind : Ingress metadata : annotations : nginx.ingress.kubernetes.io/cors-allow-headers : Content-Type nginx.ingress.kubernetes.io/cors-allow-methods : POST, GET, OPTIONS nginx.ingress.kubernetes.io/cors-expose-headers : X-Custom-Header nginx.ingress.kubernetes.io/cors-max-age : \"86400\" nginx.ingress.kubernetes.io/enable-cors : \"true\" creationTimestamp : null name : webapp-ingress namespace : booksapp spec : ingressClassName : nginx rules : - http : paths : - backend : service : name : webapp port : number : 7000 path : / pathType : Prefix status : loadBalancer : {}","title":"Sample Output"},{"location":"linkerd/","text":"Linkerd kusk-gen linkerd Usage: kusk linkerd [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --cluster.cluster_domain string kubernetes cluster domain ( default \"cluster.local\" ) --path.base string a base prefix for Service endpoints ( default \"/\" ) --timeouts.request_timeout uint32 total request timeout ( seconds ) -h, --help help for linkerd The Linkerd generator generates Service Profile resources to provide Linkerd information about routes to your service All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification. Full Options Reference Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Cluster Domain --cluster.cluster_domain cluster.cluster_domain Override the default internal cluster domain (default: cluster.local) \u274c Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705 Basic Usage CLI Flags kusk-gen linkerd -i examples/booksapp/booksapp.yaml \\ --service.name webapp \\ --namespace my-namespace \\ --service.namespace my-service-namespace OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : my-service-namespace port : 7000 paths : / : get : {} ... Sample Output --- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : / name : GET / - condition : method : GET pathRegex : /authors/[^/]* name : GET /authors/{id} - condition : method : GET pathRegex : /books/[^/]* name : GET /books/{id} - condition : method : POST pathRegex : /authors name : POST /authors - condition : method : POST pathRegex : /authors/[^/]*/delete name : POST /authors/{id}/delete - condition : method : POST pathRegex : /authors/[^/]*/edit name : POST /authors/{id}/edit - condition : method : POST pathRegex : /books name : POST /books - condition : method : POST pathRegex : /books/[^/]*/delete name : POST /books/{id}/delete - condition : method : POST pathRegex : /books/[^/]*/edit name : POST /books/{id}/edit Base Path Setting the Base path option allows your service to be identified with the base path acting as a prefix. CLI Flags kusk-gen linkerd -i examples/booksapp/booksapp.yaml \\ --service.name webapp \\ --namespace my-namespace \\ --service.namespace my-service-namespace \\ --path.base /my-app OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 path : base : /my-app paths : / : get : {} ... Sample Output --- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : /my-app/ name : GET /my-app/ - condition : method : GET pathRegex : /my-app/authors/[^/]* name : GET /my-app/authors/{id} - condition : method : GET pathRegex : /my-app/books/[^/]* name : GET /my-app/books/{id} - condition : method : POST pathRegex : /my-app/authors name : POST /my-app/authors - condition : method : POST pathRegex : /my-app/authors/[^/]*/delete name : POST /my-app/authors/{id}/delete - condition : method : POST pathRegex : /my-app/authors/[^/]*/edit name : POST /my-app/authors/{id}/edit - condition : method : POST pathRegex : /my-app/books name : POST /my-app/books - condition : method : POST pathRegex : /my-app/books/[^/]*/delete name : POST /my-app/books/{id}/delete - condition : method : POST pathRegex : /my-app/books/[^/]*/edit name : POST /my-app/books/{id}/edit Change cluster domain Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the cluster domain option will override the default internal cluster domain of cluster.local CLI Flags kusk-gen linkerd -i examples/booksapp/booksapp.yaml \\ --service.name webapp \\ --namespace my-namespace \\ --service.namespace my-service-namespace \\ --cluster.cluster_domain my-cluster.domain OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cluster : cluster_domain : my-cluster.domain paths : / : get : {} ... Sample Output --- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : /my-app/ name : GET /my-app/ - condition : method : GET pathRegex : /my-app/authors/[^/]* name : GET /my-app/authors/{id} - condition : method : GET pathRegex : /my-app/books/[^/]* name : GET /my-app/books/{id} - condition : method : POST pathRegex : /my-app/authors name : POST /my-app/authors - condition : method : POST pathRegex : /my-app/authors/[^/]*/delete name : POST /my-app/authors/{id}/delete - condition : method : POST pathRegex : /my-app/authors/[^/]*/edit name : POST /my-app/authors/{id}/edit - condition : method : POST pathRegex : /my-app/books name : POST /my-app/books - condition : method : POST pathRegex : /my-app/books/[^/]*/delete name : POST /my-app/books/{id}/delete - condition : method : POST pathRegex : /my-app/books/[^/]*/edit name : POST /my-app/books/{id}/edit Setting timeouts kusk's Linkerd generator allows for setting request timeouts via flags or the x-kusk OpenAPI extension CLI Flags kusk-gen linkerd -i examples/booksapp/booksapp.yaml \\ --service.name webapp \\ --namespace my-namespace \\ --service.namespace my-service-namespace \\ --timeouts.request_timeout 120 OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 timeouts : request_timeout : 120 paths : / : get : {} ... Sample Output --- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : / name : GET / timeout : 120s - condition : method : GET pathRegex : /authors/[^/]* name : GET /authors/{id} timeout : 120s - condition : method : GET pathRegex : /books/[^/]* name : GET /books/{id} timeout : 120s - condition : method : POST pathRegex : /authors name : POST /authors timeout : 120s - condition : method : POST pathRegex : /authors/[^/]*/delete name : POST /authors/{id}/delete timeout : 120s - condition : method : POST pathRegex : /authors/[^/]*/edit name : POST /authors/{id}/edit timeout : 120s - condition : method : POST pathRegex : /books name : POST /books timeout : 120s - condition : method : POST pathRegex : /books/[^/]*/delete name : POST /books/{id}/delete timeout : 120s - condition : method : POST pathRegex : /books/[^/]*/edit name : POST /books/{id}/edit timeout : 120s Basic Path settings override For this example, let's assume that one of the paths in the API specification should have a different request timeout value than the rest. OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 timeouts : request_timeout : 120 paths : / : get : {} /books : x-kusk : timeouts : request_timeout : 60 post : {} ... Sample Output --- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : / name : GET / timeout : 120s - condition : method : POST pathRegex : /books name : POST /books timeout : 60s","title":"Linkerd"},{"location":"linkerd/#linkerd","text":"kusk-gen linkerd Usage: kusk linkerd [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --cluster.cluster_domain string kubernetes cluster domain ( default \"cluster.local\" ) --path.base string a base prefix for Service endpoints ( default \"/\" ) --timeouts.request_timeout uint32 total request timeout ( seconds ) -h, --help help for linkerd The Linkerd generator generates Service Profile resources to provide Linkerd information about routes to your service All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification.","title":"Linkerd"},{"location":"linkerd/#full-options-reference","text":"Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Cluster Domain --cluster.cluster_domain cluster.cluster_domain Override the default internal cluster domain (default: cluster.local) \u274c Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705","title":"Full Options Reference"},{"location":"linkerd/#basic-usage","text":"","title":"Basic Usage"},{"location":"linkerd/#cli-flags","text":"kusk-gen linkerd -i examples/booksapp/booksapp.yaml \\ --service.name webapp \\ --namespace my-namespace \\ --service.namespace my-service-namespace","title":"CLI Flags"},{"location":"linkerd/#openapi-specification","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : my-service-namespace port : 7000 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"linkerd/#sample-output","text":"--- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : / name : GET / - condition : method : GET pathRegex : /authors/[^/]* name : GET /authors/{id} - condition : method : GET pathRegex : /books/[^/]* name : GET /books/{id} - condition : method : POST pathRegex : /authors name : POST /authors - condition : method : POST pathRegex : /authors/[^/]*/delete name : POST /authors/{id}/delete - condition : method : POST pathRegex : /authors/[^/]*/edit name : POST /authors/{id}/edit - condition : method : POST pathRegex : /books name : POST /books - condition : method : POST pathRegex : /books/[^/]*/delete name : POST /books/{id}/delete - condition : method : POST pathRegex : /books/[^/]*/edit name : POST /books/{id}/edit","title":"Sample Output"},{"location":"linkerd/#base-path","text":"Setting the Base path option allows your service to be identified with the base path acting as a prefix.","title":"Base Path"},{"location":"linkerd/#cli-flags_1","text":"kusk-gen linkerd -i examples/booksapp/booksapp.yaml \\ --service.name webapp \\ --namespace my-namespace \\ --service.namespace my-service-namespace \\ --path.base /my-app","title":"CLI Flags"},{"location":"linkerd/#openapi-specification_1","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 path : base : /my-app paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"linkerd/#sample-output_1","text":"--- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : /my-app/ name : GET /my-app/ - condition : method : GET pathRegex : /my-app/authors/[^/]* name : GET /my-app/authors/{id} - condition : method : GET pathRegex : /my-app/books/[^/]* name : GET /my-app/books/{id} - condition : method : POST pathRegex : /my-app/authors name : POST /my-app/authors - condition : method : POST pathRegex : /my-app/authors/[^/]*/delete name : POST /my-app/authors/{id}/delete - condition : method : POST pathRegex : /my-app/authors/[^/]*/edit name : POST /my-app/authors/{id}/edit - condition : method : POST pathRegex : /my-app/books name : POST /my-app/books - condition : method : POST pathRegex : /my-app/books/[^/]*/delete name : POST /my-app/books/{id}/delete - condition : method : POST pathRegex : /my-app/books/[^/]*/edit name : POST /my-app/books/{id}/edit","title":"Sample Output"},{"location":"linkerd/#change-cluster-domain","text":"Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the cluster domain option will override the default internal cluster domain of cluster.local","title":"Change cluster domain"},{"location":"linkerd/#cli-flags_2","text":"kusk-gen linkerd -i examples/booksapp/booksapp.yaml \\ --service.name webapp \\ --namespace my-namespace \\ --service.namespace my-service-namespace \\ --cluster.cluster_domain my-cluster.domain","title":"CLI Flags"},{"location":"linkerd/#openapi-specification_2","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cluster : cluster_domain : my-cluster.domain paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"linkerd/#sample-output_2","text":"--- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : /my-app/ name : GET /my-app/ - condition : method : GET pathRegex : /my-app/authors/[^/]* name : GET /my-app/authors/{id} - condition : method : GET pathRegex : /my-app/books/[^/]* name : GET /my-app/books/{id} - condition : method : POST pathRegex : /my-app/authors name : POST /my-app/authors - condition : method : POST pathRegex : /my-app/authors/[^/]*/delete name : POST /my-app/authors/{id}/delete - condition : method : POST pathRegex : /my-app/authors/[^/]*/edit name : POST /my-app/authors/{id}/edit - condition : method : POST pathRegex : /my-app/books name : POST /my-app/books - condition : method : POST pathRegex : /my-app/books/[^/]*/delete name : POST /my-app/books/{id}/delete - condition : method : POST pathRegex : /my-app/books/[^/]*/edit name : POST /my-app/books/{id}/edit","title":"Sample Output"},{"location":"linkerd/#setting-timeouts","text":"kusk's Linkerd generator allows for setting request timeouts via flags or the x-kusk OpenAPI extension","title":"Setting timeouts"},{"location":"linkerd/#cli-flags_3","text":"kusk-gen linkerd -i examples/booksapp/booksapp.yaml \\ --service.name webapp \\ --namespace my-namespace \\ --service.namespace my-service-namespace \\ --timeouts.request_timeout 120","title":"CLI Flags"},{"location":"linkerd/#openapi-specification_3","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 timeouts : request_timeout : 120 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"linkerd/#sample-output_3","text":"--- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : / name : GET / timeout : 120s - condition : method : GET pathRegex : /authors/[^/]* name : GET /authors/{id} timeout : 120s - condition : method : GET pathRegex : /books/[^/]* name : GET /books/{id} timeout : 120s - condition : method : POST pathRegex : /authors name : POST /authors timeout : 120s - condition : method : POST pathRegex : /authors/[^/]*/delete name : POST /authors/{id}/delete timeout : 120s - condition : method : POST pathRegex : /authors/[^/]*/edit name : POST /authors/{id}/edit timeout : 120s - condition : method : POST pathRegex : /books name : POST /books timeout : 120s - condition : method : POST pathRegex : /books/[^/]*/delete name : POST /books/{id}/delete timeout : 120s - condition : method : POST pathRegex : /books/[^/]*/edit name : POST /books/{id}/edit timeout : 120s","title":"Sample Output"},{"location":"linkerd/#basic-path-settings-override","text":"For this example, let's assume that one of the paths in the API specification should have a different request timeout value than the rest.","title":"Basic Path settings override"},{"location":"linkerd/#openapi-specification_4","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 timeouts : request_timeout : 120 paths : / : get : {} /books : x-kusk : timeouts : request_timeout : 60 post : {} ...","title":"OpenAPI Specification"},{"location":"linkerd/#sample-output_4","text":"--- apiVersion : linkerd.io/v1alpha2 kind : ServiceProfile metadata : creationTimestamp : null name : webapp.my-service-namespace.svc.cluster.local namespace : my-namespace spec : routes : - condition : method : GET pathRegex : / name : GET / timeout : 120s - condition : method : POST pathRegex : /books name : POST /books timeout : 60s","title":"Sample Output"},{"location":"openapi-extension/","text":"OpenAPI extension Kusk comes with an OpenAPI extension to accommodate everything within an OpenAPI spec to make that a real source of truth for all objects that can be generated. Every single CLI option can be set within the x-kusk extension. The extension can be specified at the root, path and operation levels. Properties Overview The following top-level properties are available: property root path operation Amb 1.X Amb 2.X LinkerD Ing-Nginx Traefik disabled X X X X X X X X host X X X X X X X X cors X X X X X X X rate_limits X X X X X X timeouts X X X X X X X X namespace X X X X X X service X X X X X X path X X X X X X cluster X X host X X X X nginx_ingress X X Property Overriding/inheritance x-kusk extension at the operation level takes precedence, i.e. overrides, what's specified at the path level, including the disabled option. Likewise, the path level settings override what's specified at the global level. If settings aren't specified at a path or operation level, it will inherit from the layer above. (Operation > Path > Global) Top-level properties Disabled This boolean property allows you to disable the corresponding path/operation, allowing you to \"hide\" internal operations from being published to end users. When set to true at the top level all paths will be hidden; you will have to override specific paths/operations with disabled: false to make those operations visible. Host This string property sets a corresponding Ingress host rule . CORS The cors object sets properties for configuring CORS for your API Name Description origins list of HTTP origins accepted by the configured operations methods list of HTTP methods accepted by the configured operations headers list of HTTP headers accepted by the configured operations expose_headers list of HTTP headers exposed by the configured operations credentials boolean flag for requiring credentials max_age the max age of the Please see the documentation for each individual generator to see which of these properties they support and how they apply. Rate Limits Options for configuring rate-limiting. Name Description rps requests-per-seconds burst burst allowance group rate-limiting group Please see the documentation for each individual generator to see which of these properties they support and how they apply. Timeouts Options for configuring request timeouts Name Description request_timeout total request timeout (in seconds) idle_timeout timeout for idle connections (in seconds) Please see the documentation for each individual generator to see which of these properties they support and how they apply. Namespace This string property sets the namespace for the generated resource. Default value is \"default\". Service The service object sets the target service to receive traffic, it contains the following properties: Name Description namespace the namespace containing the upstream Service name the upstream Service's name port the upstream Service's port. Default value is 80 Please see the documentation for each individual generator to see which of these properties they support and how they apply. Path The path object contains the following properties to configure service endpoints paths: Name Description base Base is the preceding prefix for the route (i.e. /your-prefix/here/rest/of/the/route). Default value is \"/\" trim_prefix TrimPrefix is the prefix that would be omitted from the URL when request is being forwarded to the upstream service, i.e. given that Base is set to \"/petstore/api/v3\", TrimPrefix is set to \"/petstore\", path that would be generated is \"/petstore/api/v3/pets\", URL that the upstream service would receive is \"/api/v3/pets\". split forces Kusk to generate a separate resource for each Path or Operation, where appropriate Please see the documentation for each individual generator to see which of these properties they support and how they apply. Cluster The cluster object contains a set of cluster-wide properties. Name Description cluster_domain the base DNS domain for the cluster. Default value is \"cluster.local\". Please see the documentation for each individual generator to see which of these properties they support and how they apply. Host A string specifying an Ingress host rule - see https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-rules for additional documentation. Ingress Nginx Options specific to the ingress-nginx controller Name Description rewrite_target RewriteTarget is a custom rewrite target for ingress-nginx, see https://kubernetes.github.io/ingress-nginx/examples/rewrite/ for additional documentation. Basic Example The following sets cors, service and path properties at the global level, but disables the PUT operation at /pet x-kusk : cors : origins : - http://foo.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 service : name : petstore port : 80 path : base : /petstore/api/v3 trim_prefix : /petstore paths : \"/pet\" : put : x-kusk : disabled : true tags : - pet summary : Update an existing pet description : Update an existing pet by Id operationId : updatePet ... Merging vanilla OpenAPI yaml file and x-kusk extension There are situations when you want to keep your OpenAPI file pristine and not add x-kusk extension to it. E.g. if you generate it during the build each time, or if you have multiple environments that have different x-kusk overrides per env. You can always add x-kusks enabled YAML file with extention keys and merge it with your OpenAPI file. The resulting file can be consumed by Kusk for Ingress generation. For that, you'll need to use yt tool. E.g. petstore.yaml paths : \"/pet\" : put : ... post : ... and x-kusk.yaml enabled: x-kusk : disabled : false cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 service : name : petstore port : 80 path : base : /petstore/api/v3 trim_prefix : /petstore paths : \"/pet\" : x-kusk : disabled : false put : x-kusk : disabled : true Running the tool: yq eval-all 'select(fileIndex == 0) * select(fileIndex == 1)' x-kusks.yaml petstore.yaml will produce merged yaml, ready to be used by Kusk. Note, though, that the order of keys in the resulting map can be different. If you use JSON for your OpenAPI file, the same result can be achieved with jq .","title":"OpenAPI Extension"},{"location":"openapi-extension/#openapi-extension","text":"Kusk comes with an OpenAPI extension to accommodate everything within an OpenAPI spec to make that a real source of truth for all objects that can be generated. Every single CLI option can be set within the x-kusk extension. The extension can be specified at the root, path and operation levels.","title":"OpenAPI extension"},{"location":"openapi-extension/#properties-overview","text":"The following top-level properties are available: property root path operation Amb 1.X Amb 2.X LinkerD Ing-Nginx Traefik disabled X X X X X X X X host X X X X X X X X cors X X X X X X X rate_limits X X X X X X timeouts X X X X X X X X namespace X X X X X X service X X X X X X path X X X X X X cluster X X host X X X X nginx_ingress X X","title":"Properties Overview"},{"location":"openapi-extension/#property-overridinginheritance","text":"x-kusk extension at the operation level takes precedence, i.e. overrides, what's specified at the path level, including the disabled option. Likewise, the path level settings override what's specified at the global level. If settings aren't specified at a path or operation level, it will inherit from the layer above. (Operation > Path > Global)","title":"Property Overriding/inheritance"},{"location":"openapi-extension/#top-level-properties","text":"","title":"Top-level properties"},{"location":"openapi-extension/#disabled","text":"This boolean property allows you to disable the corresponding path/operation, allowing you to \"hide\" internal operations from being published to end users. When set to true at the top level all paths will be hidden; you will have to override specific paths/operations with disabled: false to make those operations visible.","title":"Disabled"},{"location":"openapi-extension/#host","text":"This string property sets a corresponding Ingress host rule .","title":"Host"},{"location":"openapi-extension/#cors","text":"The cors object sets properties for configuring CORS for your API Name Description origins list of HTTP origins accepted by the configured operations methods list of HTTP methods accepted by the configured operations headers list of HTTP headers accepted by the configured operations expose_headers list of HTTP headers exposed by the configured operations credentials boolean flag for requiring credentials max_age the max age of the Please see the documentation for each individual generator to see which of these properties they support and how they apply.","title":"CORS"},{"location":"openapi-extension/#rate-limits","text":"Options for configuring rate-limiting. Name Description rps requests-per-seconds burst burst allowance group rate-limiting group Please see the documentation for each individual generator to see which of these properties they support and how they apply.","title":"Rate Limits"},{"location":"openapi-extension/#timeouts","text":"Options for configuring request timeouts Name Description request_timeout total request timeout (in seconds) idle_timeout timeout for idle connections (in seconds) Please see the documentation for each individual generator to see which of these properties they support and how they apply.","title":"Timeouts"},{"location":"openapi-extension/#namespace","text":"This string property sets the namespace for the generated resource. Default value is \"default\".","title":"Namespace"},{"location":"openapi-extension/#service","text":"The service object sets the target service to receive traffic, it contains the following properties: Name Description namespace the namespace containing the upstream Service name the upstream Service's name port the upstream Service's port. Default value is 80 Please see the documentation for each individual generator to see which of these properties they support and how they apply.","title":"Service"},{"location":"openapi-extension/#path","text":"The path object contains the following properties to configure service endpoints paths: Name Description base Base is the preceding prefix for the route (i.e. /your-prefix/here/rest/of/the/route). Default value is \"/\" trim_prefix TrimPrefix is the prefix that would be omitted from the URL when request is being forwarded to the upstream service, i.e. given that Base is set to \"/petstore/api/v3\", TrimPrefix is set to \"/petstore\", path that would be generated is \"/petstore/api/v3/pets\", URL that the upstream service would receive is \"/api/v3/pets\". split forces Kusk to generate a separate resource for each Path or Operation, where appropriate Please see the documentation for each individual generator to see which of these properties they support and how they apply.","title":"Path"},{"location":"openapi-extension/#cluster","text":"The cluster object contains a set of cluster-wide properties. Name Description cluster_domain the base DNS domain for the cluster. Default value is \"cluster.local\". Please see the documentation for each individual generator to see which of these properties they support and how they apply.","title":"Cluster"},{"location":"openapi-extension/#host_1","text":"A string specifying an Ingress host rule - see https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-rules for additional documentation.","title":"Host"},{"location":"openapi-extension/#ingress-nginx","text":"Options specific to the ingress-nginx controller Name Description rewrite_target RewriteTarget is a custom rewrite target for ingress-nginx, see https://kubernetes.github.io/ingress-nginx/examples/rewrite/ for additional documentation.","title":"Ingress Nginx"},{"location":"openapi-extension/#basic-example","text":"The following sets cors, service and path properties at the global level, but disables the PUT operation at /pet x-kusk : cors : origins : - http://foo.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 service : name : petstore port : 80 path : base : /petstore/api/v3 trim_prefix : /petstore paths : \"/pet\" : put : x-kusk : disabled : true tags : - pet summary : Update an existing pet description : Update an existing pet by Id operationId : updatePet ...","title":"Basic Example"},{"location":"openapi-extension/#merging-vanilla-openapi-yaml-file-and-x-kusk-extension","text":"There are situations when you want to keep your OpenAPI file pristine and not add x-kusk extension to it. E.g. if you generate it during the build each time, or if you have multiple environments that have different x-kusk overrides per env. You can always add x-kusks enabled YAML file with extention keys and merge it with your OpenAPI file. The resulting file can be consumed by Kusk for Ingress generation. For that, you'll need to use yt tool. E.g. petstore.yaml paths : \"/pet\" : put : ... post : ... and x-kusk.yaml enabled: x-kusk : disabled : false cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 service : name : petstore port : 80 path : base : /petstore/api/v3 trim_prefix : /petstore paths : \"/pet\" : x-kusk : disabled : false put : x-kusk : disabled : true Running the tool: yq eval-all 'select(fileIndex == 0) * select(fileIndex == 1)' x-kusks.yaml petstore.yaml will produce merged yaml, ready to be used by Kusk. Note, though, that the order of keys in the resulting map can be different. If you use JSON for your OpenAPI file, the same result can be achieved with jq .","title":"Merging vanilla OpenAPI yaml file and x-kusk extension"},{"location":"traefik/","text":"Traefik V2 kusk-gen traefik Usage: kusk traefik [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --host string the Host header value to listen on --path.base string a base path for Service endpoints ( default \"/\" ) --path.trim_prefix string a prefix to trim from the URL before forwarding to the upstream Service --rate_limits.burst uint32 request per second burst --rate_limits.rps uint32 request per second rate limit --timeouts.idle_timeout uint32 idle connection timeout ( seconds ) --timeouts.request_timeout uint32 total request timeout ( seconds ) -h, --help Traefik generator generates Kubernetes IngressRoute with related Middlewares and ServersTransport resources for exposing HTTP and HTTPS routes from outside the cluster to services within the cluster. All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification. Full Options Reference Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Path Trim Prefix --path.trim_prefix path.trim_prefix Trim the specified prefix from URl before passing request onto service \u274c Path split --path.split path.split Boolean; whether or not to force generator to generate a mapping for each path \u274c Ingress Host --host host The value to set the host field to in the Ingress resource \u274c Rate limit (RPS) --rate_limits.rps rate_limits.rps Request per second rate limit \u2705 Rate limit (burst) --rate_limits.burst rate_limits.burst Rate limit burst \u2705 Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705 Idle Timeout --timeouts.idle_timeout timeouts.idle_timeout Idle connection timeout (seconds) \u2705 CORS Origins N/A cors.origins Array of origins \u2705 CORS Methods N/A cors.methods Array of methods \u2705 CORS Headers N/A cors.headers Array of headers \u2705 CORS ExposeHeaders N/A cors.expose_headers Array of headers to expose \u2705 CORS Credentials N/A cors.credentials Boolean: enable credentials (default value: false) \u2705 CORS Max Age N/A cors.max_age Integer:how long the response to the preflight request can be cached for without sending another preflight request \u2705 Basic Usage CLI Flags kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 paths : / : get : {} ... Sample Output --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp Base Path and Trim Prefix Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the trim prefix options will create Traefik Middleware to trim the prefix before sending the request onto the service. CLI Flags kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.base /my-app \\ --path.trim_prefix /my-app OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 path : base : /my-app trim_prefix : /my-app paths : / : get : {} ... Sample Output --- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-strip-prefix namespace : my-namespace spec : stripPrefix : prefixes : - /my-app --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/my-app/\") && Method(\"GET\") middlewares : - name : webapp-strip-prefix namespace : my-namespace services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp Setting the Host CLI Flags kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --host mycustomhost.com OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 host : mycustomhost.com paths : / : get : {} ... Sample Output --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : Host(\"mycustomhost.com\") && PathPrefix(\"/\") && Method(\"GET\") services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp Setting timeouts kusk-gen allows for setting a request timeout via flags or the x-kusk OpenAPI extension. Traefik uses ServersTransport CRD to control timeouts to backend service. x-kusk option timeouts.request_timeout is used to set both responseHeaderTimeout and dialTimeout in CRD. x-kusk option timeouts.idle_timeout is used to set idleConnTimeout that controls closing idle keep-alive connection to backend. Zero (0) value of timeout in CRD means \"No timeout\". CLI Flags kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --timeouts.request_timeout 120 --timeouts.idle_timeout 120 OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 timeouts : request_timeout : 120 idle_timeout : 120 paths : / : get : {} ... Sample Output --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 120 idleConnTimeout : 120 responseHeaderTimeout : 120 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp Setting Rate Limits kusk-gen allows for setting a Rate Limits via flags or the x-kusk OpenAPI extension. Traefik uses RateLimit Middleware for that. x-kusk option rate_limits.rps is used to set rateLimit.average (requests per second) in CRD. x-kusk option rate_limits.burst is used to set rateLimit.burst in CRD. CLI Flags kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --rate_limits.rps 20 --rate_limits.burst 100 OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 rate_limits : rps : 20 burst : 100 paths : / : get : {} ... Sample Output --- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-ratelimit namespace : my-namespace spec : rateLimit : average : 20 burst : 100 --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") middlewares : - name : webapp-ratelimit namespace : my-namespace services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp CORS Via the x-kusk extension, you can set cors policies on your resources. OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} ... Sample Output --- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-cors namespace : booksapp spec : headers : accessControlAllowCredentials : true accessControlAllowHeaders : - Content-Type accessControlAllowMethods : - POST - GET - OPTIONS accessControlAllowOriginList : - http://foo.example - http://bar.example accessControlMaxAge : 86400 --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : booksapp spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : booksapp spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") middlewares : - name : webapp-cors namespace : booksapp services : - name : webapp namespace : booksapp port : 7000 serversTransport : webapp Basic Path settings override For this example, let's assume that one of the paths in the API specification should have different CORS headers than the rest. OpenAPI Specification openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} /books : x-kusk : cors : methods : - POST headers : - Other-Content-Type credentials : true expose_headers : - X-Other-Custom-Header max_age : 120 post : {} ... Sample Output --- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-cors namespace : booksapp spec : headers : accessControlAllowCredentials : true accessControlAllowHeaders : - Content-Type accessControlAllowMethods : - POST - GET - OPTIONS accessControlMaxAge : 86400 --- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-books-cors namespace : booksapp spec : headers : accessControlAllowCredentials : true accessControlAllowHeaders : - Other-Content-Type accessControlAllowMethods : - POST accessControlMaxAge : 120 --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : booksapp spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : booksapp spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") middlewares : - name : webapp-cors namespace : booksapp services : - name : webapp namespace : booksapp port : 7000 serversTransport : webapp - kind : Rule match : PathPrefix(\"/books\") && Method(\"POST\") middlewares : - name : webapp-books-cors namespace : booksapp services : - name : webapp namespace : booksapp port : 7000 serversTransport : webapp","title":"Traefik"},{"location":"traefik/#traefik-v2","text":"kusk-gen traefik Usage: kusk traefik [ flags ] Flags: -i, --in string file path to api spec file to generate mappings from. e.g. --in apispec.yaml --namespace string namespace for generated resources ( default \"default\" ) --service.name string target Service name --service.namespace string namespace containing the target Service ( default \"default\" ) --service.port int32 target Service port ( default 80 ) --host string the Host header value to listen on --path.base string a base path for Service endpoints ( default \"/\" ) --path.trim_prefix string a prefix to trim from the URL before forwarding to the upstream Service --rate_limits.burst uint32 request per second burst --rate_limits.rps uint32 request per second rate limit --timeouts.idle_timeout uint32 idle connection timeout ( seconds ) --timeouts.request_timeout uint32 total request timeout ( seconds ) -h, --help Traefik generator generates Kubernetes IngressRoute with related Middlewares and ServersTransport resources for exposing HTTP and HTTPS routes from outside the cluster to services within the cluster. All options that can be set via flags can also be set using our x-kusk OpenAPI extension in your specification. CLI flags apply only at the global level i.e. applies to all paths and methods. To override settings on the path or HTTP method level, you are required to use the x-kusk extension at that path in your API specification.","title":"Traefik V2"},{"location":"traefik/#full-options-reference","text":"Name CLI Option OpenAPI Spec x-kusk label Descriptions Overwritable at path / method OpenAPI or Swagger File --in N/A Location of the OpenAPI or Swagger specification \u274c Namespace --namespace namespace the namespace in which to create the generated resources (Required) \u274c Service Name --service.name service.name the name of the service running in Kubernetes (Required) \u274c Service Namespace --service.namespace service.namespace The namespace where the service named above resides (default value: default) \u274c Service Port --service.port service.port Port the service is listening on (default value: 80) \u274c Path Base --path.base path.base Prefix for your resource routes \u274c Path Trim Prefix --path.trim_prefix path.trim_prefix Trim the specified prefix from URl before passing request onto service \u274c Path split --path.split path.split Boolean; whether or not to force generator to generate a mapping for each path \u274c Ingress Host --host host The value to set the host field to in the Ingress resource \u274c Rate limit (RPS) --rate_limits.rps rate_limits.rps Request per second rate limit \u2705 Rate limit (burst) --rate_limits.burst rate_limits.burst Rate limit burst \u2705 Request Timeout --timeouts.request_timeout timeouts.request_timeout Total request timeout (seconds) \u2705 Idle Timeout --timeouts.idle_timeout timeouts.idle_timeout Idle connection timeout (seconds) \u2705 CORS Origins N/A cors.origins Array of origins \u2705 CORS Methods N/A cors.methods Array of methods \u2705 CORS Headers N/A cors.headers Array of headers \u2705 CORS ExposeHeaders N/A cors.expose_headers Array of headers to expose \u2705 CORS Credentials N/A cors.credentials Boolean: enable credentials (default value: false) \u2705 CORS Max Age N/A cors.max_age Integer:how long the response to the preflight request can be cached for without sending another preflight request \u2705","title":"Full Options Reference"},{"location":"traefik/#basic-usage","text":"","title":"Basic Usage"},{"location":"traefik/#cli-flags","text":"kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace","title":"CLI Flags"},{"location":"traefik/#openapi-specification","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"traefik/#sample-output","text":"--- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp","title":"Sample Output"},{"location":"traefik/#base-path-and-trim-prefix","text":"Setting the Base path option allows your service to be identified with the base path acting as a prefix. Setting the trim prefix options will create Traefik Middleware to trim the prefix before sending the request onto the service.","title":"Base Path and Trim Prefix"},{"location":"traefik/#cli-flags_1","text":"kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --path.base /my-app \\ --path.trim_prefix /my-app","title":"CLI Flags"},{"location":"traefik/#openapi-specification_1","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 path : base : /my-app trim_prefix : /my-app paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"traefik/#sample-output_1","text":"--- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-strip-prefix namespace : my-namespace spec : stripPrefix : prefixes : - /my-app --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/my-app/\") && Method(\"GET\") middlewares : - name : webapp-strip-prefix namespace : my-namespace services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp","title":"Sample Output"},{"location":"traefik/#setting-the-host","text":"","title":"Setting the Host"},{"location":"traefik/#cli-flags_2","text":"kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --host mycustomhost.com","title":"CLI Flags"},{"location":"traefik/#openapi-specification_2","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 host : mycustomhost.com paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"traefik/#sample-output_2","text":"--- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : Host(\"mycustomhost.com\") && PathPrefix(\"/\") && Method(\"GET\") services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp","title":"Sample Output"},{"location":"traefik/#setting-timeouts","text":"kusk-gen allows for setting a request timeout via flags or the x-kusk OpenAPI extension. Traefik uses ServersTransport CRD to control timeouts to backend service. x-kusk option timeouts.request_timeout is used to set both responseHeaderTimeout and dialTimeout in CRD. x-kusk option timeouts.idle_timeout is used to set idleConnTimeout that controls closing idle keep-alive connection to backend. Zero (0) value of timeout in CRD means \"No timeout\".","title":"Setting timeouts"},{"location":"traefik/#cli-flags_3","text":"kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --timeouts.request_timeout 120 --timeouts.idle_timeout 120","title":"CLI Flags"},{"location":"traefik/#openapi-specification_3","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 timeouts : request_timeout : 120 idle_timeout : 120 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"traefik/#sample-output_3","text":"--- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 120 idleConnTimeout : 120 responseHeaderTimeout : 120 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp","title":"Sample Output"},{"location":"traefik/#setting-rate-limits","text":"kusk-gen allows for setting a Rate Limits via flags or the x-kusk OpenAPI extension. Traefik uses RateLimit Middleware for that. x-kusk option rate_limits.rps is used to set rateLimit.average (requests per second) in CRD. x-kusk option rate_limits.burst is used to set rateLimit.burst in CRD.","title":"Setting Rate Limits"},{"location":"traefik/#cli-flags_4","text":"kusk-gen traefik -i examples/booksapp/booksapp.yaml \\ --namespace my-namespace \\ --service.name webapp \\ --service.port 7000 \\ --service.namespace my-service-namespace \\ --rate_limits.rps 20 --rate_limits.burst 100","title":"CLI Flags"},{"location":"traefik/#openapi-specification_4","text":"openapi : 3.0.1 x-kusk : namespace : my-namespace service : name : webapp namespace : my-service-namespace port : 7000 rate_limits : rps : 20 burst : 100 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"traefik/#sample-output_4","text":"--- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-ratelimit namespace : my-namespace spec : rateLimit : average : 20 burst : 100 --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : my-namespace spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") middlewares : - name : webapp-ratelimit namespace : my-namespace services : - name : webapp namespace : my-namespace port : 7000 serversTransport : webapp","title":"Sample Output"},{"location":"traefik/#cors","text":"Via the x-kusk extension, you can set cors policies on your resources.","title":"CORS"},{"location":"traefik/#openapi-specification_5","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : origins : - http://foo.example - http://bar.example methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} ...","title":"OpenAPI Specification"},{"location":"traefik/#sample-output_5","text":"--- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-cors namespace : booksapp spec : headers : accessControlAllowCredentials : true accessControlAllowHeaders : - Content-Type accessControlAllowMethods : - POST - GET - OPTIONS accessControlAllowOriginList : - http://foo.example - http://bar.example accessControlMaxAge : 86400 --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : booksapp spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : booksapp spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") middlewares : - name : webapp-cors namespace : booksapp services : - name : webapp namespace : booksapp port : 7000 serversTransport : webapp","title":"Sample Output"},{"location":"traefik/#basic-path-settings-override","text":"For this example, let's assume that one of the paths in the API specification should have different CORS headers than the rest.","title":"Basic Path settings override"},{"location":"traefik/#openapi-specification_6","text":"openapi : 3.0.1 x-kusk : namespace : booksapp service : name : webapp namespace : booksapp port : 7000 cors : methods : - POST - GET - OPTIONS headers : - Content-Type credentials : true expose_headers : - X-Custom-Header max_age : 86400 paths : / : get : {} /books : x-kusk : cors : methods : - POST headers : - Other-Content-Type credentials : true expose_headers : - X-Other-Custom-Header max_age : 120 post : {} ...","title":"OpenAPI Specification"},{"location":"traefik/#sample-output_6","text":"--- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-cors namespace : booksapp spec : headers : accessControlAllowCredentials : true accessControlAllowHeaders : - Content-Type accessControlAllowMethods : - POST - GET - OPTIONS accessControlMaxAge : 86400 --- apiVersion : traefik.containo.us/v1alpha1 kind : Middleware metadata : creationTimestamp : null name : webapp-books-cors namespace : booksapp spec : headers : accessControlAllowCredentials : true accessControlAllowHeaders : - Other-Content-Type accessControlAllowMethods : - POST accessControlMaxAge : 120 --- apiVersion : traefik.containo.us/v1alpha1 kind : ServersTransport metadata : creationTimestamp : null name : webapp namespace : booksapp spec : forwardingTimeouts : dialTimeout : 0 idleConnTimeout : 0 responseHeaderTimeout : 0 --- apiVersion : traefik.containo.us/v1alpha1 kind : IngressRoute metadata : creationTimestamp : null name : webapp namespace : booksapp spec : entryPoints : - web routes : - kind : Rule match : PathPrefix(\"/\") && Method(\"GET\") middlewares : - name : webapp-cors namespace : booksapp services : - name : webapp namespace : booksapp port : 7000 serversTransport : webapp - kind : Rule match : PathPrefix(\"/books\") && Method(\"POST\") middlewares : - name : webapp-books-cors namespace : booksapp services : - name : webapp namespace : booksapp port : 7000 serversTransport : webapp","title":"Sample Output"}]}